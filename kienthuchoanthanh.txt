| Ná»™i dung                                          | Má»©c Ä‘á»™ | Ghi chÃº                                           |
| ------------------------------------------------- | ------ | ------------------------------------------------- |
| Káº¿t ná»‘i tá»›i Directus CMS                          | âœ…      | DÃ¹ng `axios`, Ä‘á»c `.env`, Ä‘Äƒng nháº­p láº¥y token     |
| Sá»­ dá»¥ng Docker cho Directus                       | âœ…      | ÄÃ£ cÃ i Ä‘áº·t vÃ  cháº¡y Ä‘Æ°á»£c Directus UI               |
| Táº¡o collection (product, user, category)          | âœ…      | ÄÃ£ thao tÃ¡c qua UI                                |
| Láº¥y dá»¯ liá»‡u tá»« CMS (REST API)                     | âœ…      | DÃ¹ng `axios.get` vá»›i token                        |
| Sá»­ dá»¥ng `socket.io` Ä‘á»ƒ phÃ¡t sá»± kiá»‡n               | âœ…      | Táº¡o server, phÃ¡t `product_created`, `user_joined` |
| TÃ¡ch mÃ£ thÃ nh module `services/`                  | âœ…      | Tá»‘t cho cáº¥u trÃºc production                       |
| Gá»­i Ä‘Ãºng dá»¯ liá»‡u theo interface `Product`, `User` | âœ…      | DÃ¹ng TypeScript interface mÃ´ táº£ dá»¯ liá»‡u           |
| PhÃ¢n tÃ­ch lá»—i & debug `403`, `.env`, token        | âœ…      | ÄÃ£ hiá»ƒu cÃ¡ch login, sá»­a lá»—i credential, token     |

---
| Viá»‡c cáº§n lÃ m                      | MÃ´ táº£ ngáº¯n                                 |
| --------------------------------- | ------------------------------------------ |
| 1. Cáº¥u trÃºc láº¡i app NestJS        | Bá» NextJS, dÃ¹ng Nest lÃ m SSR client        |
| 2. Login Directus tá»« NestJS       | Gá»i API vá»›i 1 tÃ i khoáº£n service            |
| 3. Táº¡o collection CMS             | Gá»“m cÃ¡c trÆ°á»ng Ä‘Äƒng kÃ½ tÃ i khoáº£n CK        |
| 4. XÃ¢y API FE                     | Form gá»­i thÃ´ng tin, hiá»ƒn thá»‹ sá»‘ SV Ä‘Äƒng kÃ½ |
| 5. ThÃªm phÃ¢n quyá»n trong Directus | Táº¡o roles vÃ  set permission Ä‘Ãºng           |
| 6. Táº¡o Sequence Diagram           | DÃ¹ng Mermaid cho flow user request         |
-------
### âœ… 2. Xá»­ lÃ½ Webhook tá»« Directus

*VÃ o Directus UI > Settings > Webhooks > Add Webhook*

* URL: `http://localhost:3000/webhook/products`
* Events: `items.create`, `items.update`
* Collections: `products`

Sau Ä‘Ã³ táº¡o 1 controller `WebhookController` Ä‘á»ƒ xá»­ lÃ½ nháº­n request, rá»“i gá»i `SocketGateway` Ä‘á»ƒ `emit`.

---

### ğŸ” 3. ThÃªm báº£o máº­t vÃ  phÃ¢n quyá»n

* LÆ°u `access_token`, `refresh_token` trong memory hoáº·c Redis
* Tá»± Ä‘á»™ng lÃ m má»›i token khi háº¿t háº¡n
* Gá»i `/users/me` Ä‘á»ƒ láº¥y user hiá»‡n táº¡i vÃ  phÃ¢n quyá»n

---

### ğŸ§© 4. TÃ¹y chá»‰nh CMS

* ThÃªm field `published_at`, `status`, `owner_id` vÃ o collection `products`
* Táº¡o `hook` hoáº·c `extension` trong Directus Ä‘á»ƒ xá»­ lÃ½ logic backend
* TÃ¹y chá»‰nh nhiá»u role khÃ¡c nhau trong CMS (admin, editor, viewerâ€¦)

---

### ğŸ“Š 5. Hiá»ƒn thá»‹ phÃ­a client

* Táº¡o client React/Vue/NextJS:

  * Gá»i API Nest Ä‘á»ƒ láº¥y dá»¯ liá»‡u ban Ä‘áº§u
  * Káº¿t ná»‘i socket nháº­n `product_created`, `user_joined`
  * Update real-time UI (dashboard, danh sÃ¡ch, biá»ƒu Ä‘á»“)

---

| Viá»‡c lÃ m thÃªm         | Má»¥c Ä‘Ã­ch                                              |
| --------------------- | ----------------------------------------------------- |
| ğŸ§  Cache Access Token | TrÃ¡nh login má»—i láº§n (dÃ¹ng memory hoáº·c Redis)          |
| ğŸ”„ Tá»± refresh token   | Khi token háº¿t háº¡n, dÃ¹ng `refresh_token` Ä‘á»ƒ láº¥y má»›i    |
| ğŸ”’ Middleware báº£o máº­t | Kiá»ƒm tra token ngÆ°á»i dÃ¹ng / phÃ¢n quyá»n                |
| ğŸ§ª Viáº¿t Unit Test     | Äáº£m báº£o service/controller cháº¡y Ä‘Ãºng                  |
| ğŸ“ DTO vÃ  Validation  | Validate dá»¯ liá»‡u tá»«/to Directus                       |
| ğŸ“Š Log hoáº¡t Ä‘á»™ng      | Ghi láº¡i cÃ¡c tÆ°Æ¡ng tÃ¡c CMS, lá»—i gá»i API...             |
| ğŸ§© Webhook tÃ­ch há»£p   | Gá»­i realtime tá»« Directus vÃ o NestJS khÃ´ng cáº§n polling |

